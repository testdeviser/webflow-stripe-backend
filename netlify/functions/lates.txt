<script src="https://js.stripe.com/v3/"></script>

  <form id="checkout-form">
    <input type="text" id="name" placeholder="Full Name" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="tel" id="phone" placeholder="Phone Number" required />
    <input type="text" id="country" placeholder="Country" required />
    <input type="text" id="zip" placeholder="ZIP / Postal Code" required />

    <label>Card Number</label>
    <div id="card-number" class="StripeInput"></div>

    <label>Expiry</label>
    <div id="card-expiry" class="StripeInput"></div>

    <label>CVC</label>
    <div id="card-cvc" class="StripeInput"></div>

    <input type="text" id="product" value="Starter Plan" hidden />
    <input type="number" id="amount" value="2000" hidden />
    <div id="card-errors"></div>

    <button type="submit">Pay Now</button>
  </form>

  <script>
    const stripe = Stripe("pk_test_51RCdEdGKSLF41TDyTto9DhfMwUpo2DHIQ8fUgbx4mFx0NO9AvmU5wUze5BMEYC4izm7ribJs9El13ZEyjOpLs54300mHQHIKKo");
    const elements = stripe.elements();

    const cardNumber = elements.create("cardNumber");
    const cardExpiry = elements.create("cardExpiry");
    const cardCvc = elements.create("cardCvc");

    cardNumber.mount("#card-number");
    cardExpiry.mount("#card-expiry");
    cardCvc.mount("#card-cvc");

    const errorEl = document.querySelector("#card-errors");

    [cardNumber, cardExpiry, cardCvc].forEach(el => {
      el.on('change', event => {
        if (event.error) {
          errorEl.textContent = event.error.message;
        } else {
          errorEl.textContent = '';
        }
      });
    });

    document.querySelector("#checkout-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      errorEl.textContent = "";

      const name = document.querySelector("#name").value.trim();
      const email = document.querySelector("#email").value.trim();
      const phone = document.querySelector("#phone").value.trim();
      const country = document.querySelector("#country").value.trim();
      const zip = document.querySelector("#zip").value.trim();
      const product = document.querySelector("#product").value;
      const amount = parseInt(document.querySelector("#amount").value);

      if (!name || !email || !phone || !country || !zip) {
        errorEl.textContent = "Please fill in all required fields.";
        return;
      }

      const button = document.querySelector("#checkout-form button");
      button.disabled = true;
      button.textContent = "Processing...";

      const { paymentMethod, error } = await stripe.createPaymentMethod({
        type: "card",
        card: cardNumber,
        billing_details: {
          name,
          email,
          phone,
          address: {
            country,
            postal_code: zip
          }
        }
      });

      if (error) {
        errorEl.textContent = error.message;
        button.disabled = false;
        button.textContent = "Pay Now";
        return;
      }

      // Send to your backend
      const res = await fetch("https://lambent-axolotl-ae435b.netlify.app/.netlify/functions/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          email,
          phone,
          country,
          zip,
          payment_method_id: paymentMethod.id,
          product,
          amount
        }),
      });

      const data = await res.json();
      if (data.error) {
        errorEl.textContent = data.error;
        button.disabled = false;
        button.textContent = "Pay Now";
        return;
      }

      const result = await stripe.confirmCardPayment(data.client_secret);
      if (result.error) {
        errorEl.textContent = result.error.message;
        button.disabled = false;
        button.textContent = "Pay Now";
      } else {
        window.location.href = `/one-click-pay?customer_id=${data.customer_id}`;
      }
    });
  </script>